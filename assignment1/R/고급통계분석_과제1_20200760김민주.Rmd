---
title: "Advanced Statistical Analysis Assignment 1"
author: "Minjoo Kim (Sungshin Women's University)"
date: "`r Sys.Date()`"
output:
  pdf_document:
    latex_engine: xelatex
header-includes:
  - \usepackage{kotex}
  - \setmainfont[Path = C:/]{NanumGothic} 
---

# Problem 1

## Problem 1 - (a)
- ìœ„ ë°ì´í„°ë¥¼ data/ ê²½ë¡œì— csvë¡œ ì €ì¥í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•˜ì‹œì˜¤.

```{r}
# ì˜ˆì œ ë°ì´í„° ìƒì„±
set.seed(1)
n = 200
x = seq(0, 1, length.out = n)
y = sin(2*pi*x) + rnorm(n, sd = 0.15)

# (a) data/ ê²½ë¡œì— csvë¡œ ì €ì¥
data1 <- data.frame(x = x, y = y)
getwd()
write.csv(data1, "../../assignment1/data/problem1_data.csv")
```

## Problem 1 - (b)
- R/ í´ë” ì•„ë˜ R ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•˜ì—¬, ìœ„ì—ì„œ ì €ì¥í•œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê³ , ggplot2ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‚°ì ë„ì™€ íšŒê·€ê³¡ì„ 
ì í•©ì„ ì‹œê°í™”í•˜ì‹œì˜¤ (ggplot2ì˜goem_smooth()ì—ì„œ ì ì ˆí•œmethod ì„ íƒ)

```{r}
data2 <- read.csv("../../assignment1/data/problem1_data.csv")

library(ggplot2)
plot1<- ggplot(data=data2, aes(x=x, y=y))+
  geom_point(size=2)+
  geom_smooth(color='red',size=2)
plot1
```

## Problem 1 - (c)~(d)

- ggsave() í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ ì‘ì„±í•œ í”Œëì„ plots/í´ë”ì— ì €ì¥í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•˜ì‹œì˜¤
```{r}
ggsave(path = "../../assignment1/plots", filename = "problem1_plot.png")
```

-  Rì—ì„œ Git ë²„ì „ ì»¨íŠ¸ë¡¤ì„ ì‚¬ìš©í•˜ì—¬ commití•˜ê³  ë³¸ì¸ì˜ GitHubì— ì˜¬ë¦° í›„ GitHubì €ì¥ì†Œ ë§í¬ë¥¼ ê°™ì´ ì œì¶œí•˜ì‹œì˜¤.
  - https://github.com/minjoo0760/Advanced_Statistical_Analysis


# Problem 2

## Problem 2 - (a)
- ë²„ë¸”ì •ë ¬ì„ Rí•¨ìˆ˜ë¡œ êµ¬í˜„í•˜ê³ , ì•„ë˜ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì‹œì˜¤. ì˜¤ë¦„ì°¨ìˆœê³¼ ë‚´ë¦¼ì°¨ìˆœì„ ì˜µì…˜ìœ¼ë¡œ ë°›ì„ ìˆ˜ ìˆê²Œ í•˜ì—¬ ë‘ ê²½ìš° ëª¨ë‘ ê²°ê³¼ë¥¼ ì œì‹œí•˜ì‹œì˜¤.

```{r}
bubble_sort <- function(x, decreasing = FALSE) 
{
  n <- length(x)
  x_sorted <- x
  
  for (i in 1:(n-1)) {
    swapped <- FALSE
    for (j in 1:(n-i)) {
      if (decreasing) {
        condition <- x_sorted[j] < x_sorted[j+1] # ì˜¤ë¦„ì°¨ìˆœ
      } else {
        condition <- x_sorted[j] > x_sorted[j+1] # ë‚´ë¦¼ì°¨ìˆœ
      }
      if (condition) {
        temp <- x_sorted[j]
        x_sorted[j] <- x_sorted[j+1]
        x_sorted[j+1] <- temp
        swapped <- TRUE
      }
    }
    if (!swapped) break
  }
  return(x_sorted)
}

set.seed(1)
x <- runif(10)
print(x)
# ì˜¤ë¦„ì°¨ìˆœ
print(bubble_sort(x, decreasing = FALSE))
# ë‚´ë¦¼ì°¨ìˆœ
print(bubble_sort(x, decreasing = TRUE))
```

## Problem 2 - (b)
- í€µì •ë ¬ì„ Rí•¨ìˆ˜ë¡œ êµ¬í˜„í•˜ê³ , ì•„ë˜ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì‹œì˜¤. ì˜¤ë¦„ì°¨ìˆœê³¼ ë‚´ë¦¼ì°¨ìˆœì„ ì˜µì…˜ìœ¼ë¡œ ë°›ì„ ìˆ˜ ìˆê²Œ í•˜ì—¬ ë‘ ê²½ìš° ëª¨ë‘ ê²°ê³¼ë¥¼ ì œì‹œí•˜ì‹œì˜¤

```{r}
quick_sort <- function(x, decreasing = FALSE) 
{
  if (length(x) <= 1) {
    return(x)
  }
  pivot_idx <- ceiling(length(x) / 2)
  pivot <- x[pivot_idx]
  rest <- x[-pivot_idx]
  if (decreasing) {
    left <- rest[rest >= pivot] # ë‚´ë¦¼ì°¨ìˆœ
    right <- rest[rest < pivot] 
  } else {
    left <- rest[rest < pivot] # ì˜¤ë¦„ì°¨ìˆœ
    right <- rest[rest >= pivot]  
  }
  return(c(quick_sort(left, decreasing), pivot, quick_sort(right, decreasing)))
}

set.seed(1)
x <- runif(10)
print(x)
#ì˜¤ë¦„ì°¨ìˆœ
print(quick_sort(x, decreasing = FALSE))
#ë‚´ë¦¼ì°¨ìˆœ
print(quick_sort(x, decreasing = TRUE))
```


# Problem 3

## Problem 3 - (a)
- ìˆ˜ì¹˜ ë¯¸ë¶„ í•¨ìˆ˜ êµ¬í˜„
```{r}
numerical_derivative <- function(f, x, h = 1e-6, method = "central") 
{
  if (method == "forward") {
    # ì „ì§„ì°¨ë¶„
    return((f(x + h) - f(x)) / h)
  } else if (method == "backward") {
    # í›„ì§„ì°¨ë¶„
    return((f(x) - f(x - h)) / h)
  } else if (method == "central") {
    # ì¤‘ì‹¬ì°¨ë¶„
    return((f(x + h) - f(x - h)) / (2 * h))
  } else {
    stop('methodëŠ”â€œforwardâ€, â€œbackwardâ€, â€œcentralâ€ ê°€ ì•„ë‹˜')
  }
}

f <- function(x) cos(x) - x
f_prime <- function(x) -sin(x) - 1

x_vals <- seq(0, 2*pi, length.out = 100)

deriv_forward <- sapply(x_vals, function(x) numerical_derivative(f, x, method = "forward"))
deriv_backward <- sapply(x_vals, function(x) numerical_derivative(f, x, method = "backward"))
deriv_central <- sapply(x_vals, function(x) numerical_derivative(f, x, method = "central"))
deriv_analytical <- f_prime(x_vals)

# ì‹œê°í™”
library(ggplot2)
df <- data.frame(
  x = rep(x_vals, 4),
  derivative = c(deriv_analytical, deriv_forward, deriv_backward, deriv_central),
  method = rep(c("Analytical", "Forward", "Backward", "Central"), each = length(x_vals))
)
ggplot(df, aes(x = x, y = derivative, color = method, linetype = method)) +
  geom_line(linewidth = 1) +
  scale_linetype_manual(values = c("Analytical" = "solid", "Forward" = "dashed", 
                                    "Backward" = "dotted", "Central" = "dotdash")) +
  labs(title = "ìˆ˜ì¹˜ ë¯¸ë¶„ vs í•´ì„ì  ë¯¸ë¶„",
       subtitle = "f(x) = cos(x) - x",
       x = "x", y = "f'(x)",
       color = "Method", linetype = "Method") +
  theme_minimal() +
  theme(legend.position = "bottom")

cat("Forward ì°¨ë¶„:", mean(abs(deriv_forward - deriv_analytical)), "\n")
cat("Backward ì°¨ë¶„:", mean(abs(deriv_backward - deriv_analytical)), "\n")
cat("Central ì°¨ë¶„:", mean(abs(deriv_central - deriv_analytical)), "\n")
```

## Problem 3 - (b)
-  Newton-Raphson ë°©ë²• êµ¬í˜„
```{r}
newton_raphson <- function(f, x0, fprime = NULL, maxiter = 100, 
                          h = 1e-6, epsilon = 1e-10) 
{
  x <- x0
  for (i in 1:maxiter) {
    # ë„í•¨ìˆ˜ ê³„ì‚°
    if (is.null(fprime)) {
      # ìˆ˜ì¹˜ ë¯¸ë¶„ ì‚¬ìš© 
      fp <- numerical_derivative(f, x, h = h, method = "central")
    } else {
      fp <- fprime(x)
    }
    
    x_new <- x - f(x) / fp
    
    # ìˆ˜ë ´ ì²´í¬
    if (abs(x_new - x) < epsilon) {
      cat("ìˆ˜ë ´ ì™„ë£Œ,  ë°˜ë³µ íšŸìˆ˜:", i, "\n")
      cat("í•´:", x_new, "\n")
      cat("f(x):", f(x_new), "\n")
      return(list(root = x_new, iterations = i, f_value = f(x_new)))
    }
    x <- x_new
  }
  return(list(root = x, iterations = maxiter, f_value = f(x)))
}
```

## Problem 3 - (c)
```{r}
f <- function(x) cos(x) - x
fprime <- function(x) -sin(x) - 1
x0 <- 0.5

# ìˆ˜ì¹˜ ë¯¸ë¶„
newton_raphson(f, x0, fprime = NULL, h = 1e-6, epsilon = 1e-10)
# ë„í•¨ìˆ˜ 
newton_raphson(f, x0, fprime = fprime, epsilon = 1e-10)


```

# Problem 4

## Problem 4 - (a)
- Left Rectangle ë°©ì‹ì„ Rì½”ë“œë¡œ êµ¬í˜„í•˜ì‹œì˜¤. í•¨ìˆ˜ì˜ ì¸ìë¡œ ì ë¶„ ëŒ€ìƒ í•¨ìˆ˜ fì™€ ì ë¶„ êµ¬ê°„ a, b, ê·¸ë¦¬ê³  nì„ ì…ë ¥ë°›ëŠ”ë‹¤.
```{r}
integrate_left_rectangle <- function(f, a, b, n) 
{
  h <- (b - a) / n
  x <- seq(a, b - h, length.out = n)
  f_vals <- f(x)
  return(h * sum(f_vals))
}
```

## Problem 4 - (b)
-  Trapezoid ë°©ì‹ì„ Rì½”ë“œë¡œ êµ¬í˜„í•˜ì‹œì˜¤. í•¨ìˆ˜ì˜ ì¸ìëŠ” ìœ„ì™€ ê°™ë‹¤.
```{r}
integrate_trapezoid <- function(f, a, b, n) 
{
  h <- (b - a) / n
  x <- seq(a, b, length.out = n + 1)
  f_vals <- f(x)
  result <- h / 2 * (f_vals[1] + 2 * sum(f_vals[2:n]) + f_vals[n + 1])
  return(result)
}
```
## Problem 4 - (c)
- Simpson ë°©ì‹ì„ Rì½”ë“œë¡œ êµ¬í˜„í•˜ì‹œì˜¤. í•¨ìˆ˜ì˜ ì¸ìëŠ” ìœ„ì™€ ê°™ë‹¤.
```{r}
integrate_simpson <- function(f, a, b, n) 
{
  if (n %% 2 != 0) {
    stop("nì€ ì§ìˆ˜ì—¬ì•¼í•¨.")
  }
  
  h <- (b - a) / n
  x <- seq(a, b, length.out = n + 1)
  f_vals <- f(x)
  # í™€ìˆ˜ ì¸ë±ìŠ¤ 
  odd_indices <- seq(2, n, by = 2)
  odd_sum <- sum(f_vals[odd_indices])
  # ì§ìˆ˜ ì¸ë±ìŠ¤ 
  even_indices <- seq(3, n, by = 2)
  even_sum <- if(length(even_indices) > 0) sum(f_vals[even_indices]) else 0
  # Simpson ê³µì‹
  result <- h / 3 * (f_vals[1] + 4 * odd_sum + 2 * even_sum + f_vals[n + 1])
  return(result)
}
```
## Problem 4 - (d)
- sin(x) í•¨ìˆ˜ë¥¼ [0,ğœ‹] êµ¬ê°„ì—ì„œ ì ë¶„í•œ ê°’ì„ ì„¸ ê°œì˜ ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ê³„ì‚°í•˜ì‹œì˜¤. (n = 100ìœ¼ë¡œ ì„¤ì •í•œë‹¤.)
```{r}
f <- function(x) sin(x)
n <- 100

integrate_left_rectangle(f, 0, pi, n)
integrate_trapezoid(f, 0, pi, n)
integrate_simpson(f, 0, pi, n)
```
## Problem 4 - (e)
- í•´ì„ì ìœ¼ë¡œ êµ¬í•œ ê°’ê³¼ ìœ„ ì•Œê³ ë¦¬ì¦˜ì˜ ì°¨ì´ë¥¼ ğ‘›=10, 30, 60, 100, 150, 200ì— ëŒ€í•´ ê³„ì‚°í•˜ê³  ì•Œê³ ë¦¬ì¦˜ ë¹„êµë¥¼ ìœ„í•œ ì‹œê°í™”ë¥¼ ìˆ˜í–‰í•˜ì‹œì˜¤.
```{r}
library(ggplot2)

n_values <- c(10, 30, 60, 100, 150, 200)

# ê° ë°©ë²•ìœ¼ë¡œ ì ë¶„ê°’ ê³„ì‚°
left_results <- sapply(n_values, function(n) integrate_left_rectangle(f, 0, pi, n))
trap_results <- sapply(n_values, function(n) integrate_trapezoid(f, 0, pi, n))
simp_results <- sapply(n_values, function(n) integrate_simpson(f, 0, pi, n))

# ë°ì´í„°í”„ë ˆì„ ìƒì„± (í•´ì„ì  ê°’ë„ í¬í•¨)
results <- data.frame(
  n = rep(n_values, 4),
  value = c(rep(2, length(n_values)), left_results, trap_results, simp_results),
  method = rep(c("Analytical", "Left Rectangle", "Trapezoid", "Simpson"), each = length(n_values))
)

# ì‹œê°í™”
ggplot(results, aes(x = n, y = value, color = method)) +
  geom_line(linewidth = 1) +
  geom_point(size = 3) +
  labs(title = "Numerical vs Analytical Integration",
       x = "n", y = "Integral value") +
  theme_minimal()
```

# Problem 5

## Problem 5 - (a)
- ì•„ë˜ í–‰ë ¬ ğ´ì— í•´ë‹¹í•˜ëŠ” ğ¿ì„ êµ¬í•˜ê³ , $ğ¿ğ¿^âŠ¤$ì„ ì¶œë ¥í•˜ì—¬ ğ´ì™€ ê°™ìŒì„ í™•ì¸í•˜ì‹œì˜¤. (roundingerrorí—ˆìš©)
```{r}
A <- matrix(c(4,2,2,2,5,1,2,1,3), 3)
U <- chol(A)
L <- t(U)

print(A)
print(L %*% t(L))
```

## Problem 5 - (b)
-  ì‹ì„ í’€ê¸° ìœ„í•œ forward í•¨ìˆ˜ë¥¼ ì‘ì„±í•˜ì‹œì˜¤. (íŒíŠ¸: Rì˜ forwardsovle í•¨ìˆ˜ì™€ ê²°ê³¼ë¥¼ ë¹„êµí•  ìˆ˜ ìˆë‹¤.)
```{r}
forward_solve <- function(L, b) 
{
  n <- length(b)
  z <- numeric(n)
  for (i in 1:n) {
    sum_val <- 0
    if (i > 1) {
      sum_val <- sum(L[i, 1:(i-1)] * z[1:(i-1)])
    }
    z[i] <- (b[i] - sum_val) / L[i, i]
  }
  return(z)
}

test <- c(1, 2, 3)
forward_solve(L, test)
print(forwardsolve(L, test))
```

## Problem 5 - (c)
- ì‹ì„ í’€ê¸° ìœ„í•œ backward í•¨ìˆ˜ë¥¼ ì‘ì„±í•˜ì‹œì˜¤. (íŒíŠ¸: Rì˜ backwardsolve í•¨ìˆ˜ì™€ ê²°ê³¼ë¥¼ ë¹„êµí•  ìˆ˜ ìˆë‹¤.)
```{r}
backward_solve <- function(L, z) 
{
  n <- length(z)
  x <- numeric(n)
  for (i in n:1) {
    sum_val <- 0
    if (i < n) {
      sum_val <- sum(L[(i+1):n, i] * x[(i+1):n])
    }
    x[i] <- (z[i] - sum_val) / L[i, i]
  }
  return(x)
}

test <- c(1, 2, 3)
backward_solve(t(L), test)
print(backsolve(t(L), test))
```

## Problem 5 - (d)
-  (b)ì—ì„œ ì‘ì„±í•œ forward() í•¨ìˆ˜ì™€ (c)ì—ì„œ ì‘ì„±í•œ backward() í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬, ë‹¤ìŒ ë²¡í„°ì— ëŒ€í•´ì„  í˜•ë°©ì •ì‹($ğ´ğ‘¥ = ğ‘$)ë¥¼ í‘¸ì‹œì˜¤. 
```{r}
b <- c(1, -2, 3)

z <- forward_solve(L, b)
x <- backward_solve(t(L), z)
print(x)

x_solve <- solve(A, b)
print(x_solve)
```


# Problem 6

## Problem 6 - (a)
-  Gaussian kernel í•¨ìˆ˜ë¥¼ ê³„ì‚°í•˜ëŠ” R í•¨ìˆ˜ë¥¼ ì‘ì„±í•˜ì‹œì˜¤. ì´ë•Œ $ğœŒ=1$ì„ defaultë¡œ ì‚¬ìš©í•œë‹¤
```{r}
gaussian_kernel <- function(x, xprime, rho = 1) 
{
  exp(-rho * (x - xprime)^2)
}
```

## Problem 6 - (b)
- KRRì„ ì í•©í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì‘ì„±í•˜ì‹œì˜¤.
```{r}
fit_krr <- function(X, y, lambda = 0.0001, rho = 1) 
{
  n <- length(y)
  
  K <- matrix(0, n, n)
  for (i in 1:n) {
    for (j in 1:n) {
      K[i, j] <- gaussian_kernel(X[i], X[j], rho)
    }
  }
  
  alpha <- solve(K + lambda * diag(n), y)
  
  result <- list(
    X = X,
    y = y,
    alpha = alpha,
    lambda = lambda,
    rho = rho,
    K = K
  )
  
  class(result) <- "krr"
  return(result)
}
```

## Problem 6 - (c)
- predict í•¨ìˆ˜ë¥¼ krr í´ë˜ìŠ¤ì— ëŒ€í•´ í™•ì¥í•˜ KRR ì˜ˆì¸¡ê°’ì„ ê³„ì‚°í•´ì£¼ëŠ” í•¨ìˆ˜ë¥¼ ì‘ì„±í•˜ì‹œì˜¤.
```{r}
predict.krr <- function(object, newdata, ...) 
{
  n_train <- length(object$X)
  n_new <- length(newdata)
  predictions <- numeric(n_new)
  
  for (i in 1:n_new) {
    k_vec <- sapply(object$X, function(x) {
      gaussian_kernel(newdata[i], x, object$rho)
    })
    predictions[i] <- sum(k_vec * object$alpha)
  }
  return(predictions)
}
```

## Problem 6 - (d)
-  plot í•¨ìˆ˜ë¥¼ krr í´ë˜ìŠ¤ì— ëŒ€í•´ í™•ì¥í•˜ì—¬ ë°ì´í„°ì˜ ì‚°ì ë„ì™€ ì˜ˆì¸¡í•¨ìˆ˜ $f(x)$ë¥¼ ì‹œê°í™”í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì‘ì„±í•˜ì‹œì˜¤.
```{r}
plot.krr <- function(x, ...) 
{
  library(ggplot2)
  x_plot <- seq(min(x$X), max(x$X), length.out = 200)
  y_pred <- predict(x, x_plot)

  df_data <- data.frame(x = x$X, y = x$y, type = "Data")
  df_pred <- data.frame(x = x_plot, y = y_pred, type = "Prediction")
  
  p <- ggplot() +
    geom_point(data = df_data, aes(x = x, y = y), 
               color = "black", size = 2) +
    geom_line(data = df_pred, aes(x = x, y = y), 
              color = "red", linewidth = 1) +
    labs(title = "Kernel Ridge Regression",
         x = "x", y = "y") +
    theme_minimal()
  
  print(p)
}
```

## Problem 6 - (e)
- ì•„ë˜ì˜ ë°ì´í„°ë¥¼ ì‹œë®¬ë ˆì´ì…˜í•˜ê³ , KRRì„ ì í•©í•œ ì´í›„ predictì™€ plotí•¨ìˆ˜ë¥¼ í†µí•´ ê²°ê³¼ë¥¼ ì‹œê°í™”í•˜ì‹œì˜¤
```{r}
set.seed(1)
n = 150
X = matrix(runif(n,-1, 1), ncol = 1)
ftrue = function(x) sin(2*pi*x) + 0.5*cos(4*pi*x)
y = ftrue(X[,1]) + rnorm(n, sd = 0.1)

# ëª¨ë¸ ì í•©
model <- fit_krr(X[,1], y, lambda = 0.0001, rho = 1)

# predict í•¨ìˆ˜
# ì„ì˜ì˜ new data ìƒì„±
x_test <- seq(-1, 1, length.out = 10)
y_pred <- predict(model, x_test)

# plot í•¨ìˆ˜
plot(model)
```

